{"version":3,"file":"ng-cee-core-calculation-BbHcUYtr.mjs","sources":["../../../../../Angular-17/ESF-Angular-WFE-Library/projects/ng-cee-core/src/lib/utils/calculation.ts"],"sourcesContent":["\r\nexport class CalculationUtil {\r\n    //https://stackoverflow.com/questions/6479236/calculate-string-value-in-javascript-not-using-eval\r\n    _symbols;\r\n    constructor() {\r\n        this._symbols = {};\r\n        this.defineOperator(\"!\", this.factorial, \"postfix\", 6);\r\n        this.defineOperator(\"^\", Math.pow, \"infix\", 5, true);\r\n        this.defineOperator(\"*\", this.multiplication, \"infix\", 4);\r\n        this.defineOperator(\"/\", this.division, \"infix\", 4);\r\n        this.defineOperator(\"+\", this.last, \"prefix\", 3);\r\n        this.defineOperator(\"-\", this.negation, \"prefix\", 3);\r\n        this.defineOperator(\"+\", this.addition, \"infix\", 2);\r\n        this.defineOperator(\"-\", this.subtraction, \"infix\", 2);\r\n        this.defineOperator(\",\", Array.of, \"infix\", 1);\r\n        this.defineOperator(\"(\", this.last, \"prefix\");\r\n        this.defineOperator(\")\", null, \"postfix\");\r\n        this.defineOperator(\"min\", Math.min);\r\n        this.defineOperator(\"sqrt\", Math.sqrt);\r\n    }\r\n\r\n    // Method allowing to extend an instance with more operators and functions:\r\n    defineOperator(symbol, f, notation = \"func\", precedence = 0, rightToLeft = false) {\r\n        // Store operators keyed by their symbol/name. Some symbols may represent\r\n        // different usages: e.g. \"-\" can be unary or binary, so they are also\r\n        // keyed by their notation (prefix, infix, postfix, func):\r\n        if (notation === \"func\") precedence = 0;\r\n        this._symbols[symbol] = Object.assign({}, this._symbols[symbol], {\r\n            [notation]: {\r\n                symbol, f, notation, precedence, rightToLeft,\r\n                argCount: 1 + Number(notation === \"infix\")\r\n            },\r\n            symbol,\r\n            regSymbol: symbol.replace(/[\\\\^$*+?.()|[\\]{}]/g, '\\\\$&')\r\n                + (/\\w$/.test(symbol) ? \"\\\\b\" : \"\") // add a break if it's a name\r\n        });\r\n    }\r\n    last(...a) { return a[a.length - 1] }\r\n    negation(a) { return -a }\r\n    addition(a, b) { return a + b }\r\n    subtraction(a, b) { return a - b }\r\n    multiplication(a, b) { return a * b }\r\n    division(a, b) { return a / b }\r\n    factorial(a) {\r\n        if (a % 1 || !(+a >= 0)) return NaN\r\n        if (a > 170) return Infinity;\r\n        let b = 1;\r\n        while (a > 1) b *= a--;\r\n        return b;\r\n    }\r\n    calculate(expression) {\r\n        expression = expression.replace(/\\[/g, '(').replace(/\\]/g, ')')\r\n        .replace(/{/g, '(').replace(/}/g, ')');\r\n        let match;\r\n        const values = [],\r\n            operators = [this._symbols[\"(\"].prefix],\r\n            exec = () => {\r\n                let op = operators.pop();\r\n                values.push(op.f(...[].concat(...values.splice(-op.argCount))));\r\n                return op.precedence;\r\n            },\r\n            error = msg => {\r\n                let notation = match ? match.index : expression.length;\r\n                return `${msg} at ${notation}:\\n${expression}\\n${' '.repeat(notation)}^`;\r\n            },\r\n            pattern = new RegExp(\r\n                // Pattern for numbers\r\n                \"\\\\d+(?:\\\\.\\\\d+)?|\"\r\n                // ...and patterns for individual operators/function names\r\n                + Object.values(this._symbols)\r\n                    // longer symbols should be listed first\r\n                    .sort((a, b) => b['symbol'].length - a['symbol'].length)\r\n                    .map(val => val['regSymbol']).join('|')\r\n                + \"|(\\\\S)\", \"g\"\r\n            );\r\n        let afterValue = false;\r\n        pattern.lastIndex = 0; // Reset regular expression object\r\n        do {\r\n            match = pattern.exec(expression);\r\n            const [token, bad] = match || [\")\", undefined],\r\n                notNumber = this._symbols[token],\r\n                notNewValue = notNumber && !notNumber.prefix && !notNumber.func,\r\n                notAfterValue = !notNumber || !notNumber.postfix && !notNumber.infix;\r\n            // Check for syntax errors:\r\n            if (bad || (afterValue ? notAfterValue : notNewValue)) return error(\"Syntax error\");\r\n            if (afterValue) {\r\n                // We either have an infix or postfix operator (they should be mutually exclusive)\r\n                const curr = notNumber.postfix || notNumber.infix;\r\n                do {\r\n                    const prev = operators[operators.length - 1];\r\n                    if (((curr.precedence - prev.precedence) || prev.rightToLeft) > 0) break;\r\n                    // Apply previous operator, since it has precedence over current one\r\n                } while (exec()); // Exit loop after executing an opening parenthesis or function\r\n                afterValue = curr.notation === \"postfix\";\r\n                if (curr.symbol !== \")\") {\r\n                    operators.push(curr);\r\n                    // Postfix always has precedence over any operator that follows after it\r\n                    if (afterValue) exec();\r\n                }\r\n            } else if (notNumber) { // prefix operator or function\r\n                operators.push(notNumber.prefix || notNumber.func);\r\n                if (notNumber.func) { // Require an opening parenthesis\r\n                    match = pattern.exec(expression);\r\n                    if (!match || match[0] !== \"(\") return error(\"Function needs parentheses\")\r\n                }\r\n            } else { // number\r\n                values.push(+token);\r\n                afterValue = true;\r\n            }\r\n        } while (match && operators.length);\r\n        return operators.length ? error(\"Missing closing parenthesis\")\r\n            : match ? error(\"Too many closing parentheses\")\r\n                : values.pop() // All done!\r\n    }\r\n\r\n}\r\n"],"names":[],"mappings":"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"}