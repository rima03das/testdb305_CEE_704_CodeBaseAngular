{"version":3,"file":"ng-cee-oidc.mjs","sources":["../../../projects/ng-cee-oidc/src/lib/ng-cee-oidc.service.ts","../../../projects/ng-cee-oidc/src/lib/ng-cee-oidc.module.ts","../../../projects/ng-cee-oidc/src/public-api.ts","../../../projects/ng-cee-oidc/src/ng-cee-oidc.ts"],"sourcesContent":["import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { SharedEventsServiceService, EventResponseHandlerService, WfeStepLoaderService } from '@ng/cee-core';\r\nimport { jwtDecode } from 'jwt-decode';\r\nimport { Observable } from 'rxjs';\r\nimport { OAuthErrorEvent, OAuthService, OAuthSuccessEvent } from 'angular-oauth2-oidc';\r\n\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class NgCeeOIDCService {\r\n\r\n  private lastStepName = '.cee.step.refresh.false';\r\n  private accessTokenKey = '';\r\n  private refreshTokenKey = '';\r\n  private token = {\r\n    access_token: null,\r\n    refresh_token: null\r\n  }\r\n  private subscription: any = {};\r\n  private appConfigPath = 'assets/jsons/app_config.json';\r\n  private pauseTokenRefresh: boolean = false;\r\n  private appConfJSONData: any = {};\r\n  private logoutAllTabChannel: BroadcastChannel;\r\n\r\n  constructor(\r\n    private sharedEventsService: SharedEventsServiceService,\r\n    private eventResponseHandler: EventResponseHandlerService,\r\n    private http: HttpClient,\r\n    private router: Router,\r\n    private oauthService: OAuthService,\r\n    private wfeStepLoaderService: WfeStepLoaderService,\r\n  ) {\r\n    this.initOidc();\r\n    this.logoutAllTabChannel = new BroadcastChannel('logoutAllTab');\r\n    this.listenForClearData();\r\n  }\r\n\r\n  async initOidc() {\r\n    this.appConfJSONData = await this.http.get(this.appConfigPath).toPromise();\r\n    if (this.appConfJSONData['oidc_config']) {\r\n      const oidc_config = this.appConfJSONData['oidc_config'];\r\n      const oidcConfig = {};\r\n      oidc_config['domain'] && (oidcConfig['issuer'] = oidc_config['domain']);\r\n      oidc_config['clientId'] && (oidcConfig['clientId'] = oidc_config['clientId']);\r\n      oidc_config['clientKey'] && (oidcConfig['dummyClientSecret'] = oidc_config['clientKey']);\r\n      oidcConfig['userInfoHandler'] = oidc_config['userInfoHandler'] ? oidc_config['userInfoHandler'] : \"userInfo\";\r\n      oidcConfig['redirectUri'] = oidc_config['redirectUri'] ? oidc_config['redirectUri'] : window.location.origin;\r\n      oidcConfig['responseType'] = oidc_config['responseType'] ? oidc_config['responseType'] : 'code';\r\n      oidcConfig['scope'] = oidc_config['scope'] ? oidc_config['scope'] : 'openid profile';\r\n      // set OAuth token storage to local storage\r\n      this.oauthService.setStorage(localStorage);\r\n\r\n      this.oauthService.configure(oidcConfig);\r\n      // this.oauthService.tokenValidationHandler = new JwksValidationHandler();\r\n      if(localStorage.getItem('OIDCConnect_copy') !== null){\r\n        let icApiDatanew = JSON.parse(localStorage.getItem('OIDCConnect_copy'));\r\n        this.sharedEventsService.oidcApiEmitter.emit(icApiDatanew);\r\n      }\r\n      this.subscription['events'] = this.oauthService.events.subscribe(event => {\r\n        if (event instanceof OAuthErrorEvent) {\r\n          console.error(event);\r\n          // if the event is silent refresh error or token refresh error then logout the user and redirect to the login page\r\n          if(event.type === 'silent_refresh_error' || event.type === 'token_refresh_error'){\r\n            this.oauthService.logOut(false);\r\n            this.deleteCookie('LandingStepId');\r\n            this.deleteCookie('postUrl');\r\n            this.logoutAllTabChannel.postMessage('redirectToLogoutTabs');\r\n          }\r\n        } else if (event instanceof OAuthSuccessEvent) {\r\n          console.log(event);\r\n          switch (event.type) {\r\n            case 'token_refreshed':\r\n            case 'silently_refreshed':\r\n              break;\r\n            case 'token_received':\r\n              const icApiData = {\r\n                handler: sessionStorage.getItem('CEE_OIDC_User_Info_Handler') ? sessionStorage.getItem('CEE_OIDC_User_Info_Handler') : 'userInfo',\r\n                event_success: true,\r\n                response: {}\r\n              }\r\n              if (this.oauthService.hasValidAccessToken()) {\r\n                this.oauthService.setupAutomaticSilentRefresh();\r\n                const decoded: any = jwtDecode(this.oauthService.getAccessToken());\r\n                const days = Math.ceil((decoded.exp - decoded.iat) / (1000 * 60 * 60 * 24));\r\n                this.setToken('accessToken', this.oauthService.getAccessToken(), days, 'ACCESS_TOKEN');\r\n                this.setToken('refreshToken', this.oauthService.getRefreshToken(), days);\r\n                icApiData.response = decoded;\r\n                icApiData.response['accessToken'] = this.oauthService.getAccessToken();\r\n                // console.log(\"Token set on: \", new Date().toLocaleString());\r\n              }\r\n              else {\r\n                icApiData.response = null;\r\n              }\r\n              localStorage.setItem('OIDCConnect_copy', JSON.stringify(icApiData));\r\n              setTimeout(() => {\r\n                // console.log(\"calling  oidcApiEmitter on: \", new Date().toLocaleString());\r\n                this.sharedEventsService.oidcApiEmitter.emit(icApiData);\r\n              }, 500);\r\n              break;\r\n\r\n            default:\r\n              break;\r\n          }\r\n        }\r\n      });\r\n      this.oauthService.loadDiscoveryDocumentAndTryLogin().then(() => {\r\n        // for loginInPopup event\r\n        // if (window.opener) {\r\n        //   // window.opener.location.reload();\r\n        //   // window.close();\r\n        // }\r\n        // const icApiData = {\r\n        //   handler: sessionStorage.getItem('CEE_OIDC_User_Info_Handler') ? sessionStorage.getItem('CEE_OIDC_User_Info_Handler') : 'userInfo',\r\n        //   event_success: true,\r\n        //   response: []\r\n        // }\r\n        // if (this.oauthService.hasValidAccessToken()) {\r\n        //   this.oauthService.setupAutomaticSilentRefresh();\r\n        //   const decoded: any = jwtDecode(this.oauthService.getAccessToken());\r\n        //   const days = Math.ceil((decoded.exp - decoded.iat) / (1000 * 60 * 60 * 24));\r\n        //   this.setToken('accessToken', this.oauthService.getAccessToken(), days, 'ACCESS_TOKEN');\r\n        //   this.setToken('refreshToken', this.oauthService.getRefreshToken(), days);\r\n        //   icApiData.response = decoded;\r\n        //   icApiData.response['accessToken'] = this.oauthService.getAccessToken();\r\n        // }\r\n        // else {\r\n        //   icApiData.response = null;\r\n        // }\r\n        // this.sharedEventsService.oidcApiEmitter.emit(icApiData);\r\n      });\r\n      // this.oauthService.loadDiscoveryDocument().then(() => {\r\n      //   console.log('Discovery document loaded from .well-known/openid-configuration');\r\n      //   // Now try login\r\n      //   return this.oauthService.tryLogin();\r\n      // }).then(() => {\r\n      //   console.log('Login attempt completed');\r\n      // }).catch((error) => {\r\n      //   console.error('Error in discovery or login process:', error);\r\n      // });\r\n      \r\n      this.oauthService.setupAutomaticSilentRefresh();\r\n    }\r\n  }\r\n  /**\r\n   * function that create token object\r\n   * @param type = access_token / refresh_token\r\n   */\r\n  generateToken(type: string) {\r\n    let tokenStr: any = null;\r\n    switch (type) {\r\n      case 'access_token':\r\n        tokenStr = window.sessionStorage.getItem('CEE_Token');\r\n        break;\r\n      case 'refresh_token':\r\n        tokenStr = window.sessionStorage.getItem('CEE_RefreshToken');\r\n        break;\r\n    }\r\n    const tokenArr: Array<any> = (tokenStr) ? tokenStr.split(',').map((tokenApiKey: string) => {\r\n      const tokenKeyArr = tokenApiKey.split('##');\r\n      return {\r\n        handler: tokenKeyArr[0],\r\n        apiKey: tokenKeyArr[1]\r\n      };\r\n    }) : [];\r\n    return tokenArr;\r\n  }\r\n  init() {\r\n    this.subscription['apiIntegrationEmitter'] = this.sharedEventsService.oidcDataEmitter.subscribe(apiConfigData => {\r\n      this.token.access_token = this.generateToken('access_token');\r\n      this.token.refresh_token = this.generateToken('refresh_token');\r\n\r\n      const accessTokenHandlerObj = this.token.access_token.find(i => i.handler === apiConfigData.handler);\r\n      const refreshTokenHandlerObj = this.token.refresh_token.find(i => i.handler === apiConfigData.handler);\r\n      this.accessTokenKey = accessTokenHandlerObj ? accessTokenHandlerObj.apiKey : null;\r\n      this.refreshTokenKey = refreshTokenHandlerObj ? refreshTokenHandlerObj.apiKey : null;\r\n\r\n      // const CEE_ACCESS_TOKEN = window.sessionStorage.getItem('CEE_Token');\r\n      // const CEE_REFRESH_TOKEN = window.sessionStorage.getItem('CEE_RefreshToken');\r\n      // const accessTokenHandler = CEE_ACCESS_TOKEN ? CEE_ACCESS_TOKEN.split('##')[0] : undefined;\r\n      // this.accessTokenKey = CEE_ACCESS_TOKEN ? CEE_ACCESS_TOKEN.split('##')[1] : undefined;\r\n      // const refreshTokenKey = CEE_REFRESH_TOKEN ? CEE_REFRESH_TOKEN.split('##')[1] : undefined;\r\n\r\n      const response = this.returnResponse(apiConfigData);\r\n      // check if the data matches with the access_token handler\r\n      if (accessTokenHandlerObj) {\r\n        // then hit the api and get the access_token and refresh token and return\r\n        // cee_sub and cee_prn\r\n        this.ceeApiService(apiConfigData).subscribe(res => {\r\n          /* ESB API INTIGRATION */\r\n          if (apiConfigData.isESB && res.body.api_response) {\r\n            res.body = JSON.parse(res.body.api_response);\r\n          }\r\n          /* ESB API INTIGRATION (END) */\r\n          // console.log(res);\r\n          if (res.body) {\r\n            var formattedResponse = {};\r\n            if (res.body[this.accessTokenKey] && res.body[this.refreshTokenKey]) {\r\n              const decoded: any = jwtDecode(res.body[this.accessTokenKey]);\r\n              formattedResponse = {\r\n                cee_sub: decoded.sub,\r\n                cee_prn: decoded.prn\r\n              };\r\n              const days = Math.ceil((decoded.exp - decoded.iat) / (1000 * 60 * 60 * 24));\r\n              // console.log(days);\r\n              // console.log(decoded);\r\n              this.setToken('accessToken', res.body[this.accessTokenKey], days, 'ACCESS_TOKEN');\r\n              this.setToken('refreshToken', res.body[this.refreshTokenKey], days);\r\n              formattedResponse = { ...decoded.payload, ...formattedResponse, ...res.body };\r\n              delete formattedResponse[this.accessTokenKey];\r\n              delete formattedResponse[this.refreshTokenKey];\r\n            } else {\r\n              formattedResponse = { ...res.body };\r\n            }\r\n            // if (apiConfigData.authoriseParams) {\r\n            //   apiConfigData.authoriseParams.forEach((i) => {\r\n            //     formattedResponse[i] = res.body[i];\r\n            //   });\r\n            // }\r\n            this.emitDataToCee(response, { status: 200, body: formattedResponse }, apiConfigData, true);\r\n            // navigate to the step if the session has a failed step\r\n            const step = window.sessionStorage.getItem(this.lastStepName);\r\n            if (step) {\r\n              this.router.navigateByUrl(atob(step));\r\n              window.sessionStorage.removeItem(this.lastStepName);\r\n            }\r\n          } else {\r\n            console.error(`Something is wrong with the response`);\r\n            this.emitDataToCee(response, { status: 400, error: {} }, apiConfigData, false);\r\n          }\r\n        }, err => {\r\n          // if the login api fails the return status false and logout status false\r\n          console.error(`Error while logging , ${JSON.stringify(err)}`);\r\n          this.emitDataToCee(response, err, apiConfigData, false);\r\n        });\r\n      } else if (apiConfigData.hasAuthorisation == true) { // == because it comes as true or 'true'\r\n        // if an api has authorization true then add Authorization: Bearer access token as header params\r\n        // validate the token\r\n        this.validateAccessToken(apiConfigData);\r\n      } else {\r\n        // console.log(\"emit the Api Integration Handler Emitter\");\r\n        this.emitDataBasedOnAPIType(apiConfigData);\r\n      }\r\n    });\r\n\r\n    this.subscription['refreshtoken'] = this.sharedEventsService.apiUnauthorizedEmitter.subscribe(res => {\r\n      this.refreshAccessToken(res.oldApiConfigData);\r\n    });\r\n\r\n\r\n\r\n    this.subscription['oidcEventEmitter'] = this.sharedEventsService.oidcEventEmitter.subscribe(handler => {\r\n      localStorage.setItem('OIDCConnect', handler.event_handler.toLowerCase());\r\n      switch (handler.event_handler.toLowerCase()) {\r\n        case 'login':\r\n          this.clearAllCookie();\r\n          this.oauthService.initLoginFlow();\r\n          break;\r\n        case 'logininpopup':\r\n          this.clearAllCookie();\r\n          this.oauthService.initLoginFlowInPopup();\r\n          break;\r\n        case 'logout':\r\n          this.oauthService.logOut(false);\r\n          this.deleteCookie('LandingStepId');\r\n          this.deleteCookie('postUrl');\r\n          localStorage.removeItem(\"OIDCConnect_copy\");\r\n          this.logoutAllTabChannel.postMessage('redirectToLogoutTabs');\r\n          break;\r\n        case 'checkloginstatus':\r\n          setTimeout(() => {\r\n            let loginStateFlag = false;\r\n            if (this.oauthService.hasValidAccessToken()) {\r\n                // console.log('User is already logged in');\r\n                loginStateFlag = true;\r\n                // $$$$$$$$$$$$$$$$$$$$$$ Set User Info $$$$$$$$$$$$$$$$$$$$$$$$$\r\n                const icApiData = {\r\n                  handler: sessionStorage.getItem('CEE_OIDC_User_Info_Handler') ? sessionStorage.getItem('CEE_OIDC_User_Info_Handler') : 'userInfo',\r\n                  event_success: true,\r\n                  response: {}\r\n                }\r\n                this.oauthService.setupAutomaticSilentRefresh();\r\n                const decoded: any = jwtDecode(this.oauthService.getAccessToken());\r\n                const days = Math.ceil((decoded.exp - decoded.iat) / (1000 * 60 * 60 * 24));\r\n                this.setToken('accessToken', this.oauthService.getAccessToken(), days, 'ACCESS_TOKEN');\r\n                this.setToken('refreshToken', this.oauthService.getRefreshToken(), days);\r\n                icApiData.response = decoded;\r\n                icApiData.response['accessToken'] = this.oauthService.getAccessToken();\r\n                // console.log(\"Token set on: \", new Date().toLocaleString());\r\n                localStorage.setItem('OIDCConnect_copy', JSON.stringify(icApiData));\r\n                setTimeout(() => {\r\n                  // console.log(\"calling  oidcApiEmitter on: \", new Date().toLocaleString());\r\n                  this.sharedEventsService.oidcApiEmitter.emit(icApiData);\r\n                }, 500);\r\n                // $$$$$$$$$$$$$$$$$$$$$$$$ Set User Info Ends $$$$$$$$$$$$$$$$$$$$$$$$$$\r\n            }\r\n            const resObj = {\r\n              handler: handler,\r\n              loginStatus: loginStateFlag\r\n            }\r\n            this.sharedEventsService.oidcCheckLoginStatusEmitter.emit(resObj);\r\n          }, 2000);\r\n          \r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n  /**\r\n   * function that emits data based on API Type\r\n   * declared in API Config\r\n   * @param apiConfigData the api config Data Object\r\n   */\r\n  private emitDataBasedOnAPIType(apiConfigData) {\r\n    if (localStorage.getItem('API_TYPE').toLowerCase() === 'internal') {\r\n      if (apiConfigData.emitToken) {\r\n        this.sharedEventsService.apiConfigTokenEmitter.emit(apiConfigData);\r\n      } else {\r\n        this.sharedEventsService.apiIntegrationEventHandlerEmitter.emit(apiConfigData);\r\n      }\r\n    } else {\r\n      const { handler, urlParams, headers, queryParams, requestBody, isEvent } = apiConfigData;\r\n      this.sharedEventsService.eventHandlerEmitter.emit({ handler, urlParams, headers, queryParams, requestBody, isEvent });\r\n    }\r\n  }\r\n\r\n  private returnResponse(apiConfigData) {\r\n    return {\r\n      handler: apiConfigData.handler,\r\n      response: null,\r\n      event_success: true,\r\n      storageType: apiConfigData.storageType,\r\n      statusCode: 0,\r\n      logout: false\r\n    };\r\n  }\r\n\r\n  // function that checks access token validity\r\n  private validateAccessToken(apiConfigData) {\r\n    try {\r\n      const accessToken = this.returnAccessToken();\r\n      const decoded: any = jwtDecode(accessToken);\r\n      apiConfigData.headers.Authorization = `Bearer ${accessToken}`;\r\n      // console.log(decoded.exp, new Date().getTime(), ((decoded.exp * 1000) < new Date().getTime()));\r\n      const bufferTime = this.appConfJSONData['refreshTokenBuffer'] ? Number(this.appConfJSONData['refreshTokenBuffer']) : 5000;\r\n      // console.log(\"bufferTime: \", bufferTime)\r\n      // console.log(\"token exp: \", decoded.exp * 1000)\r\n      // console.log(\"5 sec before exp: \", (decoded.exp * 1000)-bufferTime)\r\n      // console.log(\"time now: \", new Date().getTime())\r\n      // console.log(\"Condition: \", ((decoded.exp * 1000)-bufferTime),\" < \", new Date().getTime());\r\n      // if (decoded.exp <= Number(moment(new Date().getTime()).format('X'))) {\r\n      if (((decoded.exp * 1000)-bufferTime) < new Date().getTime()) {\r\n        const _this = this;\r\n        if (this.pauseTokenRefresh) {\r\n          const tokenRefreshBuffer = setInterval(() => {\r\n            if (!this.pauseTokenRefresh) {\r\n              this.validateAccessToken(apiConfigData);\r\n              clearInterval(tokenRefreshBuffer);\r\n            }\r\n            console.warn('API call waiting for valid access token ...')           \r\n          }, 1000);\r\n        } else {\r\n          this.refreshAccessToken(apiConfigData);\r\n        }\r\n      } else {\r\n        // check if handler name matches the logout handler\r\n        if (apiConfigData.handler === localStorage.getItem('OIDC_LOGOUT_HANDLER')) {\r\n          this.logOut(apiConfigData);\r\n        } else {\r\n          this.emitDataBasedOnAPIType(apiConfigData);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(`No Access Token Found ${JSON.stringify(error)} for handler [${apiConfigData.handler}]`);\r\n      // this.emitDataBasedOnAPIType(apiConfigData);\r\n      // save the user step and on login navigate to that step\r\n      // window.sessionStorage.setItem(this.lastStepName, btoa(this.router.url));\r\n      const response = this.returnResponse(apiConfigData);\r\n      // response.logout = true;\r\n      // this.clearAllCookie();\r\n      // this.emitDataToCee(response, { status: 403, error: {} }, apiConfigData.isEvent, false);\r\n      this.saveStepAndRedirectToLogin(response, { status: 403, error: {} }, apiConfigData);\r\n    }\r\n  }\r\n  private getURL(url) {\r\n    const dynamicPath = url.match(new RegExp(/\\$\\{(.*?)\\}/g));\r\n    if (dynamicPath) {\r\n        for (const path of dynamicPath) {\r\n            const p: any = path;\r\n            const matchPath = p.match(new RegExp(/\\w+/g));\r\n            let apiPath = p;\r\n            if (matchPath) {\r\n                apiPath = localStorage.getItem(matchPath[0]);\r\n                if (!apiPath) {\r\n                    apiPath = matchPath[0];\r\n                    console.warn(`Variable ${matchPath[0]} is not declared`);\r\n                }\r\n            }\r\n            url = url.split(path).join(apiPath);\r\n        }\r\n        return url;\r\n    }\r\n    return url;\r\n}\r\n  private refreshAccessToken(oldApiConfigData) {\r\n    this.pauseTokenRefresh = true;\r\n    // if the token expired then refresh the token and store the new token and emit it to\r\n    // api integration emitter\r\n    const refreshTokenHandlerHandler = localStorage.getItem('OIDC_REFRESH_ACCESS_TOKEN_HANDLER');\r\n    const apiConfig: any = JSON.parse(localStorage.getItem('API_CONFIG'));\r\n    const apiConfigObject: any = apiConfig[refreshTokenHandlerHandler];\r\n\r\n    this.token.access_token = this.generateToken('access_token');\r\n\r\n    const accessTokenHandlerObj = this.token.access_token.find( i => i.handler === apiConfigObject.id);\r\n    this.accessTokenKey = accessTokenHandlerObj ? accessTokenHandlerObj.apiKey : null;\r\n\r\n    const response = this.returnResponse(oldApiConfigData);\r\n\r\n    // check if refresh token handler not present\r\n    // then navigate the user to the login step\r\n    if (!apiConfigObject) {\r\n      console.error(`No Refresh Token Handler Mapping Found. Logging out ....`);\r\n      this.saveStepAndRedirectToLogin(response, { status: 403, error: {} }, oldApiConfigData);\r\n      return;\r\n    } else {\r\n      const refreshTokenRequestBody = {\r\n        refresh_token: this.getCookie('refreshToken'),\r\n        grant_type: 'refresh_token'\r\n      };\r\n\r\n      const internalAPIConfig = {\r\n        handler: apiConfigObject.handler,\r\n        urlParams: {},\r\n        headers: {},\r\n        queryParams: {},\r\n        requestBody: refreshTokenRequestBody,\r\n        url: this.getURL( apiConfigObject.url),\r\n        methodType: apiConfigObject.methodType,\r\n        requestType: apiConfigObject.requestType\r\n      };\r\n      const accessTokenKey = this.accessTokenKey;\r\n      const _this = this;\r\n      this.ceeApiService(internalAPIConfig).subscribe(res => {\r\n         /* ESB API INTIGRATION */\r\n        if (apiConfigObject.isESB && res.body.api_response) {\r\n          res.body = JSON.parse(res.body.api_response);\r\n        }\r\n        /* ESB API INTIGRATION (END) */\r\n        if (res.body && res.body[accessTokenKey]) {\r\n          const decoded: any = jwtDecode(res.body[accessTokenKey]);\r\n          const days = Math.ceil((decoded.exp - decoded.iat) / (1000 * 60 * 60 * 24));\r\n          // console.log(days);\r\n          // console.log(decoded);\r\n          _this.setToken('accessToken', res.body[accessTokenKey], days, 'ACCESS_TOKEN');\r\n          oldApiConfigData.headers.Authorization = `Bearer ${res.body[accessTokenKey]}`;\r\n          _this.emitDataBasedOnAPIType(oldApiConfigData);\r\n        }\r\n        else {\r\n          console.error(`Refreshing Access Token Unsuccessful ${JSON.stringify(res)}`);\r\n        }\r\n        _this.pauseTokenRefresh = false;\r\n      }, err => {        \r\n        _this.pauseTokenRefresh = false;\r\n        console.error(`Refreshing Access Token Unsuccessful ${JSON.stringify(err)}`);\r\n        // save the user step and on login navigate to that step\r\n        // window.sessionStorage.setItem(this.lastStepName, btoa(this.router.url));\r\n        // response.logout = true;\r\n        // this.clearAllCookie();\r\n        // this.emitDataToCee(response, err, oldApiConfigData.isEvent, false);\r\n        _this.saveStepAndRedirectToLogin(response, err, oldApiConfigData);\r\n      });\r\n    }\r\n  }\r\n\r\n  private logOut(apiConfigData) {\r\n    const response = this.returnResponse(apiConfigData);\r\n    this.ceeApiService(apiConfigData).subscribe(res => {\r\n      console.log(`Log Out Successful`);\r\n      response.logout = true;\r\n      window.sessionStorage.removeItem(this.lastStepName);\r\n      this.clearAllCookie();\r\n      this.emitDataToCee(response, res, apiConfigData, true);\r\n    }, err => {\r\n      console.error(`Log Out Unsuccessful, ${JSON.stringify(err)}`);\r\n      this.emitDataToCee(response, err, apiConfigData, false);\r\n    });\r\n  }\r\n\r\n  private saveStepAndRedirectToLogin(response, err, apiConfigData) {\r\n    // save the user step and on login navigate to that step\r\n    window.sessionStorage.setItem(this.lastStepName, btoa(this.router.url));\r\n    response.logout = true;\r\n    this.clearAllCookie();\r\n    this.emitDataToCee(response, err, apiConfigData, false);\r\n  }\r\n\r\n  private returnAccessToken() {\r\n    const accessToken = `${this.getCookie('headerPayload')}.${this.getCookie('signature')}`\r\n    return accessToken;\r\n  }\r\n\r\n  /**\r\n   * function that emits back the api response for a particular api\r\n   * @param response the response object\r\n   * @param res the response\r\n   * @param apiConfigData apiconfigration object\r\n   * @param success if the api res is success\r\n   */\r\n  private emitDataToCee(response, res, apiConfigData, success) {\r\n    response.statusCode = res.status;\r\n    response.response = res.body || res.error;\r\n    response.event_success = success;\r\n    /* ESB API INTIGRATION */\r\n    if (apiConfigData.isESB && response.response.api_response) {\r\n      response.response = JSON.parse(response.response.api_response);\r\n    }\r\n    /* ESB API INTIGRATION (END) */\r\n    if (apiConfigData.isEvent) {\r\n      this.sharedEventsService.eventResponseSubscriber.emit(response);\r\n    } else {\r\n      this.eventResponseHandler.emitAPIDATA(response);\r\n    }\r\n  }\r\n\r\n\r\n  // ----------------------------------//\r\n  // Code From CEE API Integration Library\r\n  // so that OIDC Library sends http requests\r\n  // independently\r\n  // ----------------------------------//\r\n\r\n  /**\r\n   * CEE internal API Service that hits the api\r\n   * @param apiConfigData the api config data for the handler\r\n   * via internal libraries of CEE\r\n   */\r\n  private ceeApiService(apiConfigData): Observable<any> {\r\n    //\r\n    const headers = apiConfigData.headers;\r\n    // set header request type\r\n    switch (apiConfigData.requestType) {\r\n      case 'application/json':\r\n      case 'multipart/form-data':\r\n      case 'application/x-www-form-urlencoded':\r\n      case 'text/plain':\r\n        headers['Content-Type'] = apiConfigData.requestType;\r\n        break;\r\n      default:\r\n        console.error(`Invalid request type in returnHeaders: ${apiConfigData.requestType}`);\r\n    }\r\n\r\n    let apiURL = apiConfigData.url;\r\n\r\n    // set url param\r\n    for (const key of Object.keys(apiConfigData.urlParams)) {\r\n      if (apiURL.includes(`{${key}}`)) {\r\n        apiURL = apiURL.split(`{${key}}`).join(apiConfigData.urlParams[key]);\r\n      }\r\n    }\r\n\r\n    // set query param\r\n    for (const key of Object.keys(apiConfigData.queryParams)) {\r\n      if (apiURL.includes(`{${key}}`)) {\r\n        apiURL = apiURL.split(`{${key}}`).join(apiConfigData.queryParams[key]);\r\n      }\r\n    }\r\n\r\n    // set request body\r\n    let requestBody = this.formRequestBody(apiConfigData.requestBody, apiConfigData.requestType);\r\n    /* ESB API INTIGRATION */\r\n    if (apiConfigData.isESB) {\r\n      requestBody = {\r\n        api_request: JSON.stringify(requestBody)\r\n      };\r\n    }\r\n    /* ESB API INTIGRATION (END) */\r\n    switch (apiConfigData.methodType.toUpperCase()) {\r\n      case 'POST':\r\n      case 'PUT':\r\n      case 'PATCH':\r\n        return this.http[apiConfigData.methodType.toLowerCase()](\r\n          apiURL,\r\n          requestBody,\r\n          { headers, observe: 'response' });\r\n      case 'DELETE':\r\n      case 'GET':\r\n        return this.http[apiConfigData.methodType.toLowerCase()](\r\n          apiURL,\r\n          { headers, observe: 'response' });\r\n    }\r\n  }\r\n\r\n  private formRequestBody(requestData: any, type: string) {\r\n    switch (type) {\r\n      case 'text/plain':\r\n      case 'application/json':\r\n        return requestData;\r\n      case 'multipart/form-data':\r\n        const fd = new FormData();\r\n        for (const key of Object.keys(requestData)) {\r\n          fd.append(key, requestData[key]);\r\n        }\r\n        return fd;\r\n      case 'application/x-www-form-urlencoded':\r\n        const body = new URLSearchParams();\r\n        for (const key of Object.keys(requestData)) {\r\n          body.set(key, requestData[key]);\r\n        }\r\n        return body.toString();\r\n      default:\r\n        console.error(`Invalid request type in formRequestBody: ${type}`);\r\n        return {};\r\n    }\r\n  }\r\n\r\n  // ---------------------------------//\r\n  // Functions to set the cookie data\r\n  // ---------------------------------//\r\n\r\n  private clearAllCookie() {\r\n        this.deleteCookie('headerPayload');\r\n    this.deleteCookie('signature');\r\n    this.deleteCookie('refreshToken');\r\n  }\r\n\r\n  private setToken(name, value, days, type?) {\r\n    if (type === 'ACCESS_TOKEN') {\r\n      const token = value.split('.');\r\n      this.deleteCookie('headerPayload');\r\n      this.deleteCookie('signature');\r\n      this.setCookie('headerPayload', `${token[0]}.${token[1]}`, days, '/');\r\n      this.setCookie('signature', `${token[2]}`, days, '/');\r\n    } else {\r\n      this.deleteCookie(name);\r\n      this.setCookie(name, value, days, '/');\r\n    }\r\n  }\r\n\r\n  private getCookie(name: string) {\r\n    const ca: Array<string> = document.cookie.split(';');\r\n    const caLen: number = ca.length;\r\n    const cookieName = `${name}=`;\r\n    let c: string;\r\n\r\n    for (let i = 0; i < caLen; i += 1) {\r\n      c = ca[i].replace(/^\\s+/g, '');\r\n      if (c.indexOf(cookieName) === 0) {\r\n        return c.substring(cookieName.length, c.length);\r\n      }\r\n    }\r\n    return '';\r\n  }\r\n\r\n  private deleteCookie(name) {\r\n    this.setCookie(name, '', -1);\r\n  }\r\n\r\n  private setCookie(name: string, value: string, expireDays: number, path: string = '') {\r\n    const d: Date = new Date();\r\n    d.setTime(d.getTime() + expireDays * 24 * 60 * 60 * 1000);\r\n    const expires = `expires=${d.toUTCString()}`;\r\n    const cPath = path ? `; path=${path}` : '';\r\n    document.cookie = `${name}=${value}; ${expires}${cPath}`;\r\n  }\r\n  destroySubscription() {\r\n    // Called once, before the instance is destroyed.\r\n    // Add 'implements OnDestroy' to the class.\r\n    this.closeLogoutAllTabChannel();\r\n    for (const singleSubscription in this.subscription) {\r\n      if (this.subscription[singleSubscription]) {\r\n        this.subscription[singleSubscription].unsubscribe();\r\n      }\r\n    }\r\n \r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.closeLogoutAllTabChannel();\r\n  }\r\n\r\n  listenForClearData() {\r\n    this.logoutAllTabChannel.addEventListener('message', (event) => {\r\n      window.sessionStorage.clear();\r\n      this.wfeStepLoaderService.stepDataStore = {};\r\n      this.wfeStepLoaderService.blockDataStore = {};\r\n      this.router.navigate(['/']);\r\n      if (window.location.pathname === '/') {\r\n          this.router.navigateByUrl(`home`, { skipLocationChange: true });\r\n      }\r\n      });\r\n  }\r\n\r\n  closeLogoutAllTabChannel() {\r\n    if(this.logoutAllTabChannel) {\r\n      this.logoutAllTabChannel.close();\r\n    }\r\n  }\r\n}","import { HttpClientModule } from '@angular/common/http';\r\nimport { NgModule } from '@angular/core';\r\nimport { RouterModule } from '@angular/router';\r\nimport { OAuthModule } from 'angular-oauth2-oidc';\r\n\r\n@NgModule({\r\n  declarations: [],\r\n  imports: [\r\n    HttpClientModule,\r\n    RouterModule,\r\n    OAuthModule.forRoot()\r\n  ],\r\n  exports: []\r\n})\r\nexport class NgCeeOIDCModule { }\r\n","/*\r\n * Public API Surface of ng-cee-oidc\r\n */\r\n\r\nexport { NgCeeOIDCService } from './lib/ng-cee-oidc.service';\r\nexport { NgCeeOIDCModule } from './lib/ng-cee-oidc.module';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["i1"],"mappings":"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"}